2010.06.08 11:00
TPD Controller
The TPD Controller heats a sample according to a user-defined temperature schedule through the use of a closed-loop temperature control.  This involves measuring the temperature of the sample with a pyrometer, calculating the temperature error, and heating the sample resistively with an electrical current calculated by a PID algorithm.  Data about time and temperature are recorded to compare against RGA data for temperature programmed desorption.

==User Input==
At any time, the "Experiment Setup" metadata can be edited.  Before the sample is heated, the hardware setup, PID tuning parameters, and temperature schedule must be configured.  These cannot be changed from when the "RUN" button is pressed until the run is ended.  The values for the temperature limit, Current limit, and voltage limit cannot be set above the maximum value shown or below 0.

==Heating the Sample==
Once the hardware parameters are entered and the experiment is physically set up, the "RUN" button can be pressed to start heating the sample.  As long as there are no errors while connecting to the DAQ board and the power supply, the PID algorithm will immediately begin running and the sample will heat.  Every 3 ms, a new temperature reading will be obtained, the PID algorithm will iterate, and a new Current will be outputted to the power supply.  The temperature data will be passed through a running average filter to reduce noise.  In addition, measurements of actual Current and voltage outputted by the power supply will be read.  At every 20 ms interval, date, elapsed time [s], temperature setpoint [C], Current setpoint [A], sample temperature [C], measured Current [A], and measured voltage [V] will be recorded. The chart displays sample temperature, temperature setpoint, and Current setpoint as a function of time.  

At any time, the "STOP" button can be pressed to set the current to 0 A and stop the heating.  The Current and the voltage should not exceed the maxima set by the user in the hardware parameters.  However, if the "Over Current" or "Over Voltage" lights (red) go on, this means that the measured Current or voltage from the power supply has exceeded the user-selected maximum, respectively.  If the over temperature light (red) goes on, this means that the measured temperature is higher than the max temperature.  In the cases of over Current, over voltage, and over temperature, it is up to the user to stop the Current by clicking "STOP".  The program will not necessarily stop on its own.  The "Maximum Current" light (yellow) indicates that the Current being calculated by the PID controller is greater than or equal to the maximum value, and that the maximum value is being outputted instead.  The "Maximum Voltage" light (yellow) means that the measured voltage from the power supply is within 0.5 V of the voltage maximum, so the current cannot be raised any higher.  Either of these cases could mean that the sample cannot be heated to the desired temperature because of the Current or voltage limits.

==Saving Data==
Once a run is over, the collected data can be saved as a text file by clicking "SAVE".  This will prompt the user for a filepath.  A new file will be created, or an existing file will be replaced.  Data is saved in four sections: experiment metadata, input parameters, temperature schedule, and data.  Each section is separated by an empty line.  In the experiment metadata and input parameters sections, every line has a label and its respective data separated by two colons.  [Insert temperature schedule format here]  The data is formatted in columns delimited by tabs.  The first line contains the titles and all subsequent lines contain the data.  Included are date, elapsed time [s], temperature setpoint [C], current setpoint [A], sample temperature [C], measured Current [A], and measured voltage [V], in that order.  Please note that all metadata will be saved as is when "SAVE" is clicked.  For example, if the maximum Current is edited after a run but before the data is saved, the change will be reflected in the saved file.

==Resetting==
To perform another run without closing and restarting the program, "RESET" can be used.  This will clear all of the data structures that store data while the sample is being heated, as well as all charts and indicators.  It will not reset the user-inputted fields.
