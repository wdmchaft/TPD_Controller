2010.06.18 10:19
TPD Controller
The TPD Controller linearly ramps and holds the temperature of a sample using a closed-loop control.  This involves measuring the sample temperature with a thermocouple, calculating the temperature error, and heating the sample resistively using a current calculated by a PID algorithm.  Data about time and temperature are recorded so that the temperature schedule can be compared with RGA data when performing temperature programmed desorption.

==User Input==
The "Experiment Setup" metadata can be changed at any time.  Before the sample is heated, the hardware setup, PID tuning parameters, and temperature schedule must be configured.  These cannot be changed once the "RUN" button is pressed, until the run is ended.  The values for the temperature limit, Current limit, voltage limit, and power limit cannot be set above the maximum value shown, or below 0.  To create or change the temperature schedule, click "Change Temperature Schedule".  This will open a new window with an editable array into which time [s] and temperature [C] pairs can be entered.  It is important that the user only inputs valid time-temperature pairs.  For example, the times must be in increasing order, and the temperatures should be obtainable by the system.  To go back to the main screen, click "DONE".

==Heating the Sample==
Once the hardware parameters are entered and the experiment is physically set up, the "RUN" button can be pressed to start the sample heating.  As long as there are no errors while connecting to the DAQ board, temperature controller, and the power supply, the PID algorithm will immediately begin running and the sample will heat.  The power supply will say "dREM" (digital remote) on its front panel.  If error 1073807194 appears, this may mean that the GPIB connection to the power supply is not working.  If this happens, close LabVIEW, turn off the power supply, and unplug the GPIB-USB adapter from the computer.  Then plug everything back together, turn on the power supply, and restart the program.  If error 1073807246 appears, this may mean that a preexisting VISA session with the temperature controller must be closed before a new one can be opened.  To do this, close LabVIEW and open and run release_port.vi.  Be sure that the VISA resource name is set to "COM1" (the port connected to the temperature controller).  Then, try running TPD_Controller.vi again.

While the sample is being heated, a new temperature reading will be obtained from the DAQ board every 2 ms.  These values are then sent through a running average filter to reduce noise.  This average value is then stored as the "Pyrometer Temperature" every 500 ms.  Remember that the range of temperatures that can be measured by the Mikron pyrometer are 250C - 2000C.  Every 500 ms, the temperature error is calculated using the temperature from the temperature controller, the PID control algorithm is iterated, and a new current setpoint is sent to the power supply.  In addition, measurements of actual Current and voltage outputted by the power supply are read.  At every 500 ms interval, date, elapsed time [s], temperature setpoint [C], Current setpoint [A], thermocouple temperature [C], pyrometer temperature [C], measured Current [A], and measured voltage [V] are recorded. The chart displays thermocouple temperature, temperature setpoint, and measured Current as a function of time.  

At any time, the "STOP" button can be pressed to stop the heating within 500 ms.  The Current and the voltage should never exceed the maxima set by the user in the hardware parameters.  However, if the over Current or over voltage lights (red) go on, this means that the measured Current or voltage from the power supply has exceeded the maximum, respectively.  If the over temperature light (red) goes on, this means that the measured temperature is higher than the max temperature.  In the cases of over Current, over voltage, and over temperature, it is up to the user to stop the program by clicking "STOP".  If the offending value is only slightly out of range, it may be okay to allow the run to continue.  The "Maximum Current" light (yellow) indicates that the measured Current is within .1 A of the maximum value, and that the current cannot be raised any higher.  The "Maximum Voltage" light (yellow) means that the measured voltage from the power supply is within 0.1 V of the voltage maximum, and the power supply has entered constant voltage mode.  This means that the current cannot be raised any higher without raising the maximum voltage.  Either of these cases could mean that the sample cannot be heated to the desired temperature because of the Current or voltage limits.

==Saving Data==
Once a run is over, the collected data can be saved as a text file by clicking "SAVE".  This will prompt the user for a filepath.  A new file will be created, or an existing file will be replaced.  Data is saved in four sections: experiment metadata, input parameters, temperature schedule, and data.  Each section is separated by an empty line.  In the experiment metadata and input parameters sections, every line has a label and respective data separated by two colons.  The temperature schedule section has columns of time and temperature values delimited by tabs.  The first row has the titles, and the subsequent rows contain the setpoints.  The data is also formatted in columns delimited by tabs.  The first line has the titles, and all subsequent lines have the data.  Included are date, elapsed time [s], temperature setpoint [C], current setpoint [A], thermocouple temperature [C], pyrometer temperature [C], measured Current [A], and measured voltage [V].  

==Resetting==
To perform another run without closing and restarting the program, "RESET" can be used.  This will clear all of the data structures that collect data while the sample is being heated, as well as all charts and indicators.  It will not reset the input parameters or metadata.
